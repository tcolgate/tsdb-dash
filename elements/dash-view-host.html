<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/flatiron-director/flatiron-director.html">
<link rel="import" href="dash-dtrange.html">
<link rel="import" href="dash-tsdb-tree.html">
<link rel="import" href="dash-tsdb-plotset.html">
<link rel="import" href="dash-tsdb-plot.html">
<link rel="import" href="dash-spec.html">

<script src="dash-view-host.js"></script>
<polymer-element name="dash-view-host" attributes="start_time end_time host data groups htree activeGroups">
  <template>
    <template if="{{ host != undefined }}">
      <core-ajax auto url="../groupings.json" 
        handleAs="json"
        on-core-response="{{gotGroups}}">
      </core-ajax>

      <dash-tsdb-tree tree_id="1" result="{{atree}}"></dash-tsdb-tree>
      <template repeat="{{ at in atree.branches}}">
        <template if="{{ at.displayName == host }}">
        <dash-tsdb-tree branch_id={{at.branchId}} on-tree-result="{{gotHTreeResult}}"></dash-tsdb-tree>
        <template>
      </template>

      <template repeat="{{ act in activeGroups}}">
        <h4> {{ act.name }} </h4>
        <template repeat="{{ chart in act.charts}}">
          <dash-spec
               specName="{{ chart }}"
             globaltags="{{ tags }}"
                   spec="{{ spec }}">
          </dash-spec>

          <template if="{{ spec != undefined }}">
            <dash-tsdb-plotset 
                width=600,
               height=300,
                 spec={{spec}}
                start={{start_time}}
                  end={{end_time}}
              results={{data}}>
            </dash-tsdb-plotset>

            <template if="{{ data != undefined }}">
              <template repeat="{{ d in data }}">
                <dash-tsdb-plot 
                    style="float: left;"
                    spec={{spec}}
                    name={{d.name}}
                    data={{d.data}}
                   width=500
                   height=300
                   on-plot-select="{{ plotSelected }}">
                </dash-tsdb-plot>
              </template>
            </template>
          </template>
        <div style="clear:both;"></div>
        </template>
      </template>

    </template>
  </template>
</polymer-element>
